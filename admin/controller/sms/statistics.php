<?php define("SMS_CONTROLER_URL", DIR_APPLICATION . 'model/sms/'); require_once (defined("SMS_CONTROLER_URL")?SMS_CONTROLER_URL:"") .'smsController.php'; class ControllerSmsStatistics extends SmsController { public $dateFrom; public $dateTo; public $eshopsms = 1; public $eshopsms1 = 1; public $bulksms = 1; public $bulksms2 = 1; public $status; public function index() { $i738fb66ac1450318a6afd838e3ce268b59e35f75 = new DateTime(); $this->defaultValueDefine("dateFrom", $i738fb66ac1450318a6afd838e3ce268b59e35f75->format("Y-m-d") . " 00:00"); $this->defaultValueDefine("dateTo", $i738fb66ac1450318a6afd838e3ce268b59e35f75->format("Y-m-d") . " 23:55"); parent::index(); } public function display() { $iae8c74e5273dec25096dbae362493a9f609ecfc8 = parent::display(); $i7f261894a2f47535041bff3d2f42c3969e819d98 = array(1 => v_smshistory_adminsms, 2 => v_smshistory_customersms, 3 => v_smshistory_marketingsms, 4 => v_smshistory_simplesms); $i9c6a17481310bf83b3790385a687d69b1e23705c = array(0 => v_smshistory_status, SmsModel::STATUS_SENT => v_smshistory_sent, SmsModel::STATUS_ERROR => v_smshistory_error, SmsModel::STATUS_DELIVERED => v_smshistory_delivered, SmsModel::STATUS_BUFFERED => v_smshistory_buffered, SmsModel::STATUS_SIMULATION => v_smshistory_simulation, SmsModel::STATUS_SHEDULED => v_smshistory_sheduled, SmsModel::STATUS_DELETED => v_smshistory_deleted, SmsModel::STATUS_DND => v_smshistory_dnd, SmsModel::STATUS_DUPLICATE => v_smshistory_duplicate); $ib83c86c74d3e9f51c0ab647b6ef0170f7cfb6aa3 = $if86ca4067b9a41aaa64dbd9da964168e67986614 = array(); $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= ' <h2>' . v_statistics . '</h2> <fieldset> <legend><img src="' . self::$setingsImg . '" alt="' . v_statistics . '" /> ' . v_statistics . '</legend> <form action="" method="post"> <table> <tbody> <tr> <td>' . v_statistics_datefrom . '</td> <td>' . self::getInput(array("type" => "text", "id" => "dateFrom", "name" => "dateFrom", "class" => "datetime", "value" => $this->dateFrom)) . '</td> <td>' . v_statistics_dateto . '</td> <td>' . self::getInput(array("type" => "text", "id" => "dateTo", "name" => "dateTo", "class" => "datetime", "value" => $this->dateFrom)) . '</td> <td>' . self::getSelect(array("name" => "status"), $i9c6a17481310bf83b3790385a687d69b1e23705c, $this->status) . '</td> <td>' . self::getInput(array("type" => "checkbox", "name" => "eshopsms1", "value" => 1), $this->eshopsms1) . ' ' . v_smshistory_adminsms . '</td> <td>' . self::getInput(array("type" => "checkbox", "name" => "eshopsms", "value" => 1), $this->eshopsms) . ' ' . v_smshistory_customersms . '</td> <td>' . self::getInput(array("type" => "checkbox", "name" => "bulksms", "value" => 1), $this->bulksms) . ' ' . v_smshistory_marketingsms . '</td> <td>' . self::getInput(array("type" => "checkbox", "name" => "bulksms2", "value" => 1), $this->bulksms2) . ' ' . v_smshistory_simplesms . '</td> <td>' . self::getInput(array("type" => "submit", "name" => "submitSmsStatistics", "value" => v_smshistory_show, "class" => "button")) . '</td> </tr> </tbody> </table> </form> </fieldset> '; $i332652b6cf5a341a4fb6cf5605262cf0b166d105 = array(); if($this->eshopsms == 1) { $i332652b6cf5a341a4fb6cf5605262cf0b166d105[] = 2; } if($this->eshopsms1 == 1) { $i332652b6cf5a341a4fb6cf5605262cf0b166d105[] = 1; } if($this->bulksms == 1) { $i332652b6cf5a341a4fb6cf5605262cf0b166d105[] = 3; } if($this->bulksms2 == 1) { $i332652b6cf5a341a4fb6cf5605262cf0b166d105[] = 4; } $idacee85242f68129250771eb362503f41015a410 = ""; if(count($i332652b6cf5a341a4fb6cf5605262cf0b166d105) > 0) { $idacee85242f68129250771eb362503f41015a410 = " AND type IN (" . implode(",", $i332652b6cf5a341a4fb6cf5605262cf0b166d105) . ")"; } $i62b6b7ccb62a11971c871b454301b89c98c3f56c = ""; if($this->status > 0) { $i62b6b7ccb62a11971c871b454301b89c98c3f56c = " AND status=" . $this->escape($this->status); } $i7b1a81807908263425eee98db0b75d4ddca3762e = $this->escape($this->dateFrom); $i7ed055c4d1cfcfda0953feab1f3b732af2ab1a3d = $this->escape($this->dateTo); $ic6e936002fe51b97bc1b95f337c09606ceb011de = $this->Execute("SELECT count(*) as count FROM " . DB_PREFIX . "sp_sms_history where date >= '" . $i7b1a81807908263425eee98db0b75d4ddca3762e . "' AND date <= '" . $i7ed055c4d1cfcfda0953feab1f3b732af2ab1a3d . "' " . $i62b6b7ccb62a11971c871b454301b89c98c3f56c . "" . $idacee85242f68129250771eb362503f41015a410 . ""); if($ic6e936002fe51b97bc1b95f337c09606ceb011de->num_rows) { foreach($ic6e936002fe51b97bc1b95f337c09606ceb011de->rows as $i43ef5aef4168652439ef5de195405ced9f0f7952) { $i5d66d7c5090e9cf0a74886f1e059dd6d582d9384 = $i43ef5aef4168652439ef5de195405ced9f0f7952['count']; } } if($i5d66d7c5090e9cf0a74886f1e059dd6d582d9384 > 0) { $iae8c74e5273dec25096dbae362493a9f609ecfc8 .=' <fieldset> <legend><img src="' . self::$catalogImg . '" alt="" /> ' . ucfirst(v_adminsms_jstotalsms) . " " . $i5d66d7c5090e9cf0a74886f1e059dd6d582d9384 . '</legend>'; $ic6e936002fe51b97bc1b95f337c09606ceb011de = $this->Execute("SELECT type, count(ID) count FROM " . DB_PREFIX . "sp_sms_history WHERE date >= '" . $i7b1a81807908263425eee98db0b75d4ddca3762e . "' AND date <= '" . $i7ed055c4d1cfcfda0953feab1f3b732af2ab1a3d . "' " . $i62b6b7ccb62a11971c871b454301b89c98c3f56c . "" . $idacee85242f68129250771eb362503f41015a410 . " GROUP BY type order by ID desc"); if($ic6e936002fe51b97bc1b95f337c09606ceb011de->num_rows) { foreach($ic6e936002fe51b97bc1b95f337c09606ceb011de->rows as $i43ef5aef4168652439ef5de195405ced9f0f7952) { $ib83c86c74d3e9f51c0ab647b6ef0170f7cfb6aa3[] = "['" . $i7f261894a2f47535041bff3d2f42c3969e819d98[$i43ef5aef4168652439ef5de195405ced9f0f7952["type"]] . "', " . $i43ef5aef4168652439ef5de195405ced9f0f7952["count"] . "]"; } } $ic6e936002fe51b97bc1b95f337c09606ceb011de = $this->Execute("SELECT status, count(ID) count FROM " . DB_PREFIX . "sp_sms_history WHERE status != 2 and date >= '" . $i7b1a81807908263425eee98db0b75d4ddca3762e . "' AND date <= '" . $i7ed055c4d1cfcfda0953feab1f3b732af2ab1a3d . "' " . $i62b6b7ccb62a11971c871b454301b89c98c3f56c . "" . $idacee85242f68129250771eb362503f41015a410 . " GROUP BY status ORDER BY ID desc"); if($ic6e936002fe51b97bc1b95f337c09606ceb011de->num_rows) { foreach($ic6e936002fe51b97bc1b95f337c09606ceb011de->rows AS $i43ef5aef4168652439ef5de195405ced9f0f7952) { $if86ca4067b9a41aaa64dbd9da964168e67986614[] = "['" . ucfirst(mb_strtolower($i9c6a17481310bf83b3790385a687d69b1e23705c[$i43ef5aef4168652439ef5de195405ced9f0f7952["status"]], 'UTF-8')) . "', " . $i43ef5aef4168652439ef5de195405ced9f0f7952["count"] . "]"; } } $ic6e936002fe51b97bc1b95f337c09606ceb011de = $this->Execute("SELECT note, status, count(ID) count FROM " . DB_PREFIX . "sp_sms_history WHERE status = 2 and date >= '" . $i7b1a81807908263425eee98db0b75d4ddca3762e . "' AND date <= '" . $i7ed055c4d1cfcfda0953feab1f3b732af2ab1a3d . "' " . $i62b6b7ccb62a11971c871b454301b89c98c3f56c . "" . $idacee85242f68129250771eb362503f41015a410 . " GROUP BY note ORDER BY ID desc"); if($ic6e936002fe51b97bc1b95f337c09606ceb011de->num_rows) { foreach($ic6e936002fe51b97bc1b95f337c09606ceb011de->rows as $i43ef5aef4168652439ef5de195405ced9f0f7952) { $if86ca4067b9a41aaa64dbd9da964168e67986614[] = "['" . ucfirst(mb_strtolower($i9c6a17481310bf83b3790385a687d69b1e23705c[$i43ef5aef4168652439ef5de195405ced9f0f7952["status"]], 'UTF-8')) . " - " . trim($i43ef5aef4168652439ef5de195405ced9f0f7952["note"]) . "', " . $i43ef5aef4168652439ef5de195405ced9f0f7952["count"] . "]"; } } $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= ' <script type="text/javascript" src="https://www.google.com/jsapi"></script> <script type="text/javascript"> google.load("visualization", "1", {packages:["corechart"]}); google.setOnLoadCallback(drawChart); function drawChart() { ' . $this->f1021fd65ecb4dbab3d5a88571ad798b026db2fcf("send", $ib83c86c74d3e9f51c0ab647b6ef0170f7cfb6aa3, v_smshistory_type) . ' ' . $this->f1021fd65ecb4dbab3d5a88571ad798b026db2fcf("status", $if86ca4067b9a41aaa64dbd9da964168e67986614, v_smshistory_status) . ' } </script> '; $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= $this->f965a57942cf3c954a63b1f02e96efa263f7b6e48("send"); $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= $this->f965a57942cf3c954a63b1f02e96efa263f7b6e48("status"); } else { $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= ' <div> <b>' . v_smshistory_nosms . '</b> </div>'; } $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= '</fieldset>'; $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= " <script type=\"text/javascript\"> jQuery('#dateFrom').datetimepicker({ lang:'" . lang_iso_code . "', value:'" . $this->dateFrom . "' }); jQuery('#dateTo').datetimepicker({ lang:'" . lang_iso_code . "', value:'" . $this->dateTo . "' }); </script> "; return $iae8c74e5273dec25096dbae362493a9f609ecfc8; } public function postProcess($icddcd508600972f2dab78cd14f7612aa4dc19a18 = NULL, $i6b496fee24729ce6f7683ba88d5a87d6130049b5 = NULL, $ifab26c5df1e4ac29b64e0a4796b1f9165fe614a8 = NULL) { if($icddcd508600972f2dab78cd14f7612aa4dc19a18 == NULL && $i6b496fee24729ce6f7683ba88d5a87d6130049b5 == NULL) { return self::POST_ERROR; } if(isset($ifab26c5df1e4ac29b64e0a4796b1f9165fe614a8['submitSmsStatistics'])) { $this->dateFrom = $this->escapePostVariables("dateFrom"); $this->dateTo = $this->escapePostVariables("dateTo"); $this->eshopsms = $this->escapePostVariables("eshopsms"); $this->eshopsms1 = $this->escapePostVariables("eshopsms1"); $this->bulksms = $this->escapePostVariables("bulksms"); $this->bulksms2 = $this->escapePostVariables("bulksms2"); $this->status = $this->escapePostVariables("status"); } return self::POST_ERROR; } private function f1021fd65ecb4dbab3d5a88571ad798b026db2fcf($i9002e83be34cd5231edf8dad3f43d5fabe403d59, $iced8cbcfca3c880f0f157e119d1cc6f8691e7e89, $ie6e6350379c67647978931ac1f1e2a7032803a90, $i1bb7fc7c25016b731b6999b6606facccd35eb38b = SMS_STAT_BACK_COLOR, $iabefa6c3ecc97cfa60a0e6da725f861897f57f63 = "PieChart", $i512c0c7f3b7f42eb3286b3a90ea9120c72c6a6e8 = "value") { return ' var data' . $i9002e83be34cd5231edf8dad3f43d5fabe403d59 . ' = google.visualization.arrayToDataTable([ [\'SMS\', \'Count\'], ' . implode(",", $iced8cbcfca3c880f0f157e119d1cc6f8691e7e89) . ' ]); var options' . $i9002e83be34cd5231edf8dad3f43d5fabe403d59 . ' = { title: \'' . $ie6e6350379c67647978931ac1f1e2a7032803a90 . '\', backgroundColor: \'' . $i1bb7fc7c25016b731b6999b6606facccd35eb38b . '\', pieSliceText: \'' . $i512c0c7f3b7f42eb3286b3a90ea9120c72c6a6e8 . '\', }; var chart' . $i9002e83be34cd5231edf8dad3f43d5fabe403d59 . ' = new google.visualization.' . $iabefa6c3ecc97cfa60a0e6da725f861897f57f63 . '(document.getElementById(\'' . $i9002e83be34cd5231edf8dad3f43d5fabe403d59 . '\')); chart' . $i9002e83be34cd5231edf8dad3f43d5fabe403d59 . '.draw(data' . $i9002e83be34cd5231edf8dad3f43d5fabe403d59 . ', options' . $i9002e83be34cd5231edf8dad3f43d5fabe403d59 . '); '; } private function f965a57942cf3c954a63b1f02e96efa263f7b6e48($i9002e83be34cd5231edf8dad3f43d5fabe403d59) { return '<div id="' . $i9002e83be34cd5231edf8dad3f43d5fabe403d59 . '" style="width: 50%; height: 500px; display: inline-block;"></div>'; } } 