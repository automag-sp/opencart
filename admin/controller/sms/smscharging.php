<?php define("SMS_CONTROLER_URL", DIR_APPLICATION . 'model/sms/'); require_once (defined("SMS_CONTROLER_URL")?SMS_CONTROLER_URL:"") .'smsController.php'; class ControllerSmsSmscharging extends SmsController { public function index() { parent::index(); } public function display() { $iae8c74e5273dec25096dbae362493a9f609ecfc8 = parent::display(); $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= "<script type=\"text/javascript\" src=\"" . DIR_SMS_JS . "sms.js\"></script>"; $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= ' <h2>' . v_smsprestashop_smscharging_h2 . '</h2> <p>' . v_smsprestashop_smscharging_description . '</p> <div> <fieldset> <legend><img src="' . self::$adminCustomerImg . '" alt="" /> ' . v_smsprestashop_smscharging_fieldset . '</legend> <table class="resultTable"> '; $id733956a6e4d3adab7c8636aa9c497ae8a6be3e5 = $this->getStore(false); if(count($id733956a6e4d3adab7c8636aa9c497ae8a6be3e5) > 0) { foreach($id733956a6e4d3adab7c8636aa9c497ae8a6be3e5 as $i99184948e69e3ba68d346e935eeda3f65f91b4b4 => $i1b4593e77e14bf2e7048f7b02f24756466d0ffad) { $id227af2c9c9dc7fb91df7f7576cb79df3d47aaf4 = false; $ic6e936002fe51b97bc1b95f337c09606ceb011de = $this->Execute("SELECT * FROM " . DB_PREFIX . "sp_optout_prices WHERE shop_id='" . $this->escape($i99184948e69e3ba68d346e935eeda3f65f91b4b4) . "'"); if($ic6e936002fe51b97bc1b95f337c09606ceb011de->num_rows) { foreach($ic6e936002fe51b97bc1b95f337c09606ceb011de->rows AS $i43ef5aef4168652439ef5de195405ced9f0f7952) { $id227af2c9c9dc7fb91df7f7576cb79df3d47aaf4 = $i43ef5aef4168652439ef5de195405ced9f0f7952["active"]; } } $i4f493e441cc60b6a3540d5647c6fbcf3f2d966fc = ""; if($id227af2c9c9dc7fb91df7f7576cb79df3d47aaf4) { $i4f493e441cc60b6a3540d5647c6fbcf3f2d966fc = '<span style="cursor:help;" title="' . v_smsprestashop_smscharging_optoutactive . '"><img src="' . self::$acceptImg . '" alt="' . v_smsprestashop_smscharging_optoutactive . '"/></span>'; } else { $i4f493e441cc60b6a3540d5647c6fbcf3f2d966fc = '<span style="cursor:help;" title="' . v_smsprestashop_smscharging_optoutnotactive . '\"><img src="' . self::$denyImg . '" alt="' . v_smsprestashop_smscharging_optoutnotactive . '"/></span>'; } $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= ' <tr ' . self::isEven($if3b517d335a2b4ef26a37d2656c41c234b2a734a, "even") . '> <td><a id="displayText' . $i99184948e69e3ba68d346e935eeda3f65f91b4b4 . '" href="javascript:\" onclick="toggleInfo(' . htmlspecialchars($i99184948e69e3ba68d346e935eeda3f65f91b4b4) . ');"><img src="' . self::$plusImg . '" id="toggleButton' . $i99184948e69e3ba68d346e935eeda3f65f91b4b4 . '"/> ' . $i1b4593e77e14bf2e7048f7b02f24756466d0ffad . '</a></td> <td class="right">' . $i4f493e441cc60b6a3540d5647c6fbcf3f2d966fc . '</td> </tr> <tr class="hidden noHover" id="toggleText' . htmlspecialchars($i99184948e69e3ba68d346e935eeda3f65f91b4b4) . '"> <td colspan="2">' . $this->smsOptOutForm($i99184948e69e3ba68d346e935eeda3f65f91b4b4) . '</td> </tr> '; } } $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= ' </table> </fieldset> </div> '; $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= " <script type=\"text/javascript\"> var minus = '" . self::$minusImg . "'; var plus = '" . self::$plusImg . "'; </script> "; return $iae8c74e5273dec25096dbae362493a9f609ecfc8; } public function smsOptOutForm($i99184948e69e3ba68d346e935eeda3f65f91b4b4) { $iae8c74e5273dec25096dbae362493a9f609ecfc8 = ""; $ic6e936002fe51b97bc1b95f337c09606ceb011de = $this->Execute("SELECT * FROM " . DB_PREFIX . "sp_optout_prices WHERE shop_id='" . $this->escape($i99184948e69e3ba68d346e935eeda3f65f91b4b4) . "'"); $id227af2c9c9dc7fb91df7f7576cb79df3d47aaf4 = array(); if($ic6e936002fe51b97bc1b95f337c09606ceb011de->num_rows) { foreach($ic6e936002fe51b97bc1b95f337c09606ceb011de->rows as $i43ef5aef4168652439ef5de195405ced9f0f7952) { $i6ac79bdc940ae4cdd0107c72e3d0d238031e3903[$i43ef5aef4168652439ef5de195405ced9f0f7952["currency"]] = $i43ef5aef4168652439ef5de195405ced9f0f7952["price"]; $id227af2c9c9dc7fb91df7f7576cb79df3d47aaf4[$i43ef5aef4168652439ef5de195405ced9f0f7952["currency"]] = $i43ef5aef4168652439ef5de195405ced9f0f7952["active"]; } } else { $i6ac79bdc940ae4cdd0107c72e3d0d238031e3903 = array(); $id227af2c9c9dc7fb91df7f7576cb79df3d47aaf4 = array(); } $ic6e936002fe51b97bc1b95f337c09606ceb011de = $this->Execute("SELECT * FROM " . DB_PREFIX . "sp_optout_texts WHERE shop_id='" . $this->escape($i99184948e69e3ba68d346e935eeda3f65f91b4b4) . "'"); if($ic6e936002fe51b97bc1b95f337c09606ceb011de->num_rows) { foreach($ic6e936002fe51b97bc1b95f337c09606ceb011de->rows as $i43ef5aef4168652439ef5de195405ced9f0f7952) { $if18460607bc986787d9954dbd6c94110b9fc2691[$i43ef5aef4168652439ef5de195405ced9f0f7952["lang"]] = $i43ef5aef4168652439ef5de195405ced9f0f7952["text"]; } } $id37ad94a7a9cd11fcc3bd8a5d861c0ee1b309e8d = array(); $if53555bf47ccd06eb232e28e02c1d680265339da = 0; $i7e32e13c4cf6fd17e1f4e71186b01bde73c7d6d9 = ""; $ic6e936002fe51b97bc1b95f337c09606ceb011de = $this->Execute($this->getDefaultCurrency()); if(isset($ic6e936002fe51b97bc1b95f337c09606ceb011de->row["store_id"])) { foreach($ic6e936002fe51b97bc1b95f337c09606ceb011de->rows as $i43ef5aef4168652439ef5de195405ced9f0f7952) { if($i43ef5aef4168652439ef5de195405ced9f0f7952["store_id"] == $i99184948e69e3ba68d346e935eeda3f65f91b4b4) { $i7e32e13c4cf6fd17e1f4e71186b01bde73c7d6d9 .= self::getInput(array("type" => "text", "name" => "price_" . $i43ef5aef4168652439ef5de195405ced9f0f7952["value"], "style" => "width:50px;", "value" => ((isset($i6ac79bdc940ae4cdd0107c72e3d0d238031e3903[$i43ef5aef4168652439ef5de195405ced9f0f7952["value"]])) ? ($i6ac79bdc940ae4cdd0107c72e3d0d238031e3903[$i43ef5aef4168652439ef5de195405ced9f0f7952["value"]]) : ""))) . ' ' . strtoupper($i43ef5aef4168652439ef5de195405ced9f0f7952["value"]); $id37ad94a7a9cd11fcc3bd8a5d861c0ee1b309e8d[] = $i43ef5aef4168652439ef5de195405ced9f0f7952["value"]; if(isset($id227af2c9c9dc7fb91df7f7576cb79df3d47aaf4[$i43ef5aef4168652439ef5de195405ced9f0f7952["value"]])) { $if53555bf47ccd06eb232e28e02c1d680265339da = $id227af2c9c9dc7fb91df7f7576cb79df3d47aaf4[$i43ef5aef4168652439ef5de195405ced9f0f7952["value"]]; } } } } else { if($i99184948e69e3ba68d346e935eeda3f65f91b4b4 == 0) { $i43ef5aef4168652439ef5de195405ced9f0f7952 = $ic6e936002fe51b97bc1b95f337c09606ceb011de->row; $i7e32e13c4cf6fd17e1f4e71186b01bde73c7d6d9 .= self::getInput(array("type" => "text", "name" => "price_" . $i43ef5aef4168652439ef5de195405ced9f0f7952["value"], "style" => "width:50px;", "value" => ((isset($i6ac79bdc940ae4cdd0107c72e3d0d238031e3903[$i43ef5aef4168652439ef5de195405ced9f0f7952["value"]])) ? ($i6ac79bdc940ae4cdd0107c72e3d0d238031e3903[$i43ef5aef4168652439ef5de195405ced9f0f7952["value"]]) : ""))) . ' ' . strtoupper($i43ef5aef4168652439ef5de195405ced9f0f7952["value"]); $id37ad94a7a9cd11fcc3bd8a5d861c0ee1b309e8d[] = $i43ef5aef4168652439ef5de195405ced9f0f7952["value"]; if(isset($id227af2c9c9dc7fb91df7f7576cb79df3d47aaf4[$i43ef5aef4168652439ef5de195405ced9f0f7952["value"]])) { $if53555bf47ccd06eb232e28e02c1d680265339da = $id227af2c9c9dc7fb91df7f7576cb79df3d47aaf4[$i43ef5aef4168652439ef5de195405ced9f0f7952["value"]]; } } } ksort($id37ad94a7a9cd11fcc3bd8a5d861c0ee1b309e8d); $ia8e57c26dea7d321a12572819cd7c05c1fd3a025 = true; $ic6e936002fe51b97bc1b95f337c09606ceb011de = $this->Execute("SELECT * FROM `" . DB_PREFIX . "sp_config` WHERE `shop_id` = '".$this->escape($i99184948e69e3ba68d346e935eeda3f65f91b4b4)."' AND `config_name` = 'optout_auto'"); if($ic6e936002fe51b97bc1b95f337c09606ceb011de->num_rows) { foreach($ic6e936002fe51b97bc1b95f337c09606ceb011de->rows as $i43ef5aef4168652439ef5de195405ced9f0f7952) { $ia8e57c26dea7d321a12572819cd7c05c1fd3a025 = $i43ef5aef4168652439ef5de195405ced9f0f7952["config_value"]; } } $i62259e4d2a109cd2e2457f7ac21d96138638075f = array(); $iab99c200bf72221c3b9bfaaf3a3f74bb2c95846f = ' <table class="formTable"> <tbody> '; $ic6e936002fe51b97bc1b95f337c09606ceb011de = $this->Execute($this->getLanguages()); if($ic6e936002fe51b97bc1b95f337c09606ceb011de->num_rows) { foreach($ic6e936002fe51b97bc1b95f337c09606ceb011de->rows as $i43ef5aef4168652439ef5de195405ced9f0f7952) { $iab99c200bf72221c3b9bfaaf3a3f74bb2c95846f .= '<tr><td>' . self::getInput(array("type" => "text", "class" => "p98", "name" => "texts_" . $i43ef5aef4168652439ef5de195405ced9f0f7952["code"], "value" => ((isset($if18460607bc986787d9954dbd6c94110b9fc2691[$i43ef5aef4168652439ef5de195405ced9f0f7952["code"]])) ? ($if18460607bc986787d9954dbd6c94110b9fc2691[$i43ef5aef4168652439ef5de195405ced9f0f7952["code"]]) : ("")))) . ' ' . $i43ef5aef4168652439ef5de195405ced9f0f7952["code"] . ' - ' . $i43ef5aef4168652439ef5de195405ced9f0f7952["name"] . ' </td></tr>'; $i62259e4d2a109cd2e2457f7ac21d96138638075f[] = $i43ef5aef4168652439ef5de195405ced9f0f7952["code"]; } } $iab99c200bf72221c3b9bfaaf3a3f74bb2c95846f .= ' </tbody> </table> '; $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= ' <form action="" method="post"> <table class="formTable"> <tbody> <tr> <td colspan="2" class="w100">' . self::getInput(array("name" => "prices", "type" => "checkbox", "value" => 1), $if53555bf47ccd06eb232e28e02c1d680265339da) . ' ' . v_smsprestashop_smscharging_active . '</td> <td>' . v_smsprestashop_smscharging_price . '</td> <td>' . v_smsprestashop_smscharging_texts . '</td> <tr/> <tr> <td colspan="2">' .'<b>'.v_optout_auto_variable.'</b><br/>' .self::getInput(array("name" => "auto", "type" => "radio", "value" => 1), $ia8e57c26dea7d321a12572819cd7c05c1fd3a025)." ".v_optout_auto." <br/>" .self::getInput(array("name" => "auto", "type" => "radio", "value" => 0), (($ia8e57c26dea7d321a12572819cd7c05c1fd3a025)?0:1))." ".v_optout_manual .'</td> <td >' . $i7e32e13c4cf6fd17e1f4e71186b01bde73c7d6d9 . '</td> <td rowspan="3" class="top">' . $iab99c200bf72221c3b9bfaaf3a3f74bb2c95846f . '</td> <tr/> <tr> <td class="right top" rowspan="2">' . self::getInput(array("type" => "submit", "name" => "submitOptOut", "class" => "button", "value" => v_adminsms_save)) . '</td> <td class="left top" rowspan="2">' . self::getInput(array("type" => "reset", "class" => "button", "value" => v_adminsms_cancel, "title" => v_adminsms_restoreunsaved)) . '</td> <td></td> </tr> </tbody> </table> ' . self::getInput(array("name" => "currenciespre", "type" => "hidden", "value" => implode("__", $id37ad94a7a9cd11fcc3bd8a5d861c0ee1b309e8d))) . ' ' . self::getInput(array("name" => "textspre", "type" => "hidden", "value" => implode("__", $i62259e4d2a109cd2e2457f7ac21d96138638075f))) . ' ' . self::getInput(array("name" => "shop", "type" => "hidden", "value" => "$i99184948e69e3ba68d346e935eeda3f65f91b4b4")) . ' </form> '; return $iae8c74e5273dec25096dbae362493a9f609ecfc8; } public function postProcess($icddcd508600972f2dab78cd14f7612aa4dc19a18 = NULL, $i6b496fee24729ce6f7683ba88d5a87d6130049b5 = NULL, $ifab26c5df1e4ac29b64e0a4796b1f9165fe614a8 = NULL) { if($icddcd508600972f2dab78cd14f7612aa4dc19a18 == NULL && $i6b496fee24729ce6f7683ba88d5a87d6130049b5 == NULL) { return self::POST_ERROR; } if(isset($ifab26c5df1e4ac29b64e0a4796b1f9165fe614a8['submitOptOut'])) { $ibc3810a568b642f7341d0bdd5e76365a82d51107 = array(); $i3f5d7e20ec014ab7b44ef5a1853777312baa7ca4 = array(); $id227af2c9c9dc7fb91df7f7576cb79df3d47aaf4 = $this->escapePostVariables('prices'); $iaed7e8ab5ca37316bcfae6b58f262b39e61f5cc8 = $this->escapePostVariables('currenciespre'); $i1131913dfb2b53c90b6e9a6039e84558a8466d45 = $this->escapePostVariables('textspre'); $ibde9096c2620747ae85e1b4216c173b802a53e29 = $this->escapePostVariables('shop'); $ia8e57c26dea7d321a12572819cd7c05c1fd3a025 = $this->escapePostVariables('auto'); $id37ad94a7a9cd11fcc3bd8a5d861c0ee1b309e8d = explode("__", $iaed7e8ab5ca37316bcfae6b58f262b39e61f5cc8); $i62259e4d2a109cd2e2457f7ac21d96138638075f = explode("__", $i1131913dfb2b53c90b6e9a6039e84558a8466d45); $this->Execute("DELETE FROM " . DB_PREFIX . "sp_optout_prices WHERE shop_id = '" . $this->escape($ibde9096c2620747ae85e1b4216c173b802a53e29) . "'"); foreach($id37ad94a7a9cd11fcc3bd8a5d861c0ee1b309e8d as $i0e4db502c191d65f4204e889a1aff420bded9efe) { $this->Execute("INSERT INTO " . DB_PREFIX . "sp_optout_prices VALUES ('NULL', '" . $this->escape($ibde9096c2620747ae85e1b4216c173b802a53e29) . "', '" . trim(str_replace(",", ".", $this->escape($icddcd508600972f2dab78cd14f7612aa4dc19a18['price_' . $i0e4db502c191d65f4204e889a1aff420bded9efe]))) . "','" . $this->escape($i0e4db502c191d65f4204e889a1aff420bded9efe) . "','" . $this->escape($id227af2c9c9dc7fb91df7f7576cb79df3d47aaf4) . "')"); $i3f5d7e20ec014ab7b44ef5a1853777312baa7ca4[$i0e4db502c191d65f4204e889a1aff420bded9efe] = trim(str_replace(",", ".", $this->escapePostVariables('price_' . $i0e4db502c191d65f4204e889a1aff420bded9efe))); } $this->Execute("DELETE FROM " . DB_PREFIX . "sp_optout_texts WHERE shop_id = '" . $this->escape($ibde9096c2620747ae85e1b4216c173b802a53e29) . "'"); foreach($i62259e4d2a109cd2e2457f7ac21d96138638075f as $i0e4db502c191d65f4204e889a1aff420bded9efe) { $this->Execute("INSERT INTO " . DB_PREFIX . "sp_optout_texts VALUES ('NULL', '" . $this->escape($ibde9096c2620747ae85e1b4216c173b802a53e29) . "', '" . $this->escape($icddcd508600972f2dab78cd14f7612aa4dc19a18['texts_' . $i0e4db502c191d65f4204e889a1aff420bded9efe]) . "','" . $this->escape($i0e4db502c191d65f4204e889a1aff420bded9efe) . "')"); $ibc3810a568b642f7341d0bdd5e76365a82d51107[$i0e4db502c191d65f4204e889a1aff420bded9efe] = $this->escape($icddcd508600972f2dab78cd14f7612aa4dc19a18['texts_' . $i0e4db502c191d65f4204e889a1aff420bded9efe]); } $this->Execute("DELETE FROM " . DB_PREFIX . "sp_config WHERE shop_id = '" . $this->escape($ibde9096c2620747ae85e1b4216c173b802a53e29) . "' AND config_name='optout_auto'"); $this->Execute("INSERT INTO `" . DB_PREFIX . "sp_config` (`config_name`, `config_value`, `shop_id`) VALUES ('optout_auto', '".$this->escape($ia8e57c26dea7d321a12572819cd7c05c1fd3a025)."', '".$this->escape($ibde9096c2620747ae85e1b4216c173b802a53e29)."');"); if($id227af2c9c9dc7fb91df7f7576cb79df3d47aaf4 == 1) { $this->smsProduct($id37ad94a7a9cd11fcc3bd8a5d861c0ee1b309e8d, $ibde9096c2620747ae85e1b4216c173b802a53e29, $ibc3810a568b642f7341d0bdd5e76365a82d51107, $i3f5d7e20ec014ab7b44ef5a1853777312baa7ca4); } $this->displayConfirmation(v_smsprestashop_smscharging_saved); return self::POST_OK; } return self::POST_ERROR; } } 