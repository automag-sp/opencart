<?php define("SMS_CONTROLER_URL", DIR_APPLICATION . 'model/sms/'); require_once (defined("SMS_CONTROLER_URL")?SMS_CONTROLER_URL:"") .'smsController.php'; define("MAX_ROWS", 50); class ControllerSmsAnswers extends SmsController { public $year; public $month; public $filter; public function index() { $this->defaultValueDefine("year", date("Y")); $this->defaultValueDefine("month", date("m")); parent::index(); } public function ajaxReload($iced8cbcfca3c880f0f157e119d1cc6f8691e7e89) { $this->defaultValueDefine("year", date("Y")); $this->defaultValueDefine("month", date("m")); $this->disableScrollUp(); $ic6e936002fe51b97bc1b95f337c09606ceb011de = $this->Execute("SELECT * FROM `".DB_PREFIX."sp_answers` WHERE prohlednuto = 0 LIMIT 1"); if($ic6e936002fe51b97bc1b95f337c09606ceb011de->num_rows) { $this->sendSnippet("output", $this->fd11003dbd24a6a42d88076bf735e03f1004285aa()); } } public function display() { $iae8c74e5273dec25096dbae362493a9f609ecfc8 = parent::display(); $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= "<script type=\"text/javascript\" src=\"" . DIR_SMS_JS . "sms.js\"></script>"; $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= '<div id="snippet-output">'.$this->fd11003dbd24a6a42d88076bf735e03f1004285aa().'</div>'; if(count($_POST) == 0 && !isset($_GET["filter"]) && !isset($_GET["ps"])) { $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= '<script type="text/javascript"> setInterval( function() { jQuery.getJSON("'.$this->smsLinkAnswersReload().'"); } ,10000); </script>'; } $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= " <script type=\"text/javascript\"> var minus = '" . self::$minusImg . "'; var plus = '" . self::$plusImg . "'; </script> "; return $iae8c74e5273dec25096dbae362493a9f609ecfc8; } public function postProcess($icddcd508600972f2dab78cd14f7612aa4dc19a18 = NULL, $i6b496fee24729ce6f7683ba88d5a87d6130049b5 = NULL, $ifab26c5df1e4ac29b64e0a4796b1f9165fe614a8 = NULL) { if($icddcd508600972f2dab78cd14f7612aa4dc19a18 == NULL && $i6b496fee24729ce6f7683ba88d5a87d6130049b5 == NULL) { return -1; } if(isset($icddcd508600972f2dab78cd14f7612aa4dc19a18['submitSmsAnswers'])) { $icddcd508600972f2dab78cd14f7612aa4dc19a18 = $this->escapeInput($icddcd508600972f2dab78cd14f7612aa4dc19a18); unset($icddcd508600972f2dab78cd14f7612aa4dc19a18["submitSmsAnswers"]); $this->f87ea1407be58b4a740725f94d5f6240f2d6ee2c0($icddcd508600972f2dab78cd14f7612aa4dc19a18); $this->filter = base64_encode(serialize($icddcd508600972f2dab78cd14f7612aa4dc19a18)); } return -1; } private static function premadeDate($ie10f888510a016f5ea5f46b736afa9e60fb62395) { if($ie10f888510a016f5ea5f46b736afa9e60fb62395 == -1) { $i37f4b8b95a320aa390065744e77631364347ccc1 = "%"; } elseif(strlen($ie10f888510a016f5ea5f46b736afa9e60fb62395) == 1) { $i37f4b8b95a320aa390065744e77631364347ccc1 = "0" . $ie10f888510a016f5ea5f46b736afa9e60fb62395; } else { $i37f4b8b95a320aa390065744e77631364347ccc1 = $ie10f888510a016f5ea5f46b736afa9e60fb62395; } return $i37f4b8b95a320aa390065744e77631364347ccc1; } private function fd6c72b15565c8e885c3b26238faabaec4f644a06($iced8cbcfca3c880f0f157e119d1cc6f8691e7e89) { $this->filter = $_GET["filter"]; $i47945e993004c137f2a9e8ebe8c6a37da82bbd94 = unserialize(base64_decode($iced8cbcfca3c880f0f157e119d1cc6f8691e7e89)); $this->f87ea1407be58b4a740725f94d5f6240f2d6ee2c0($i47945e993004c137f2a9e8ebe8c6a37da82bbd94); } private function f87ea1407be58b4a740725f94d5f6240f2d6ee2c0($i47945e993004c137f2a9e8ebe8c6a37da82bbd94) { $this->year = $i47945e993004c137f2a9e8ebe8c6a37da82bbd94["year"]; $this->month = $i47945e993004c137f2a9e8ebe8c6a37da82bbd94["month"]; } private function fd11003dbd24a6a42d88076bf735e03f1004285aa() { $iae8c74e5273dec25096dbae362493a9f609ecfc8 = ""; if(isset($_GET["filter"]) && $_GET["filter"] != "" && $this->filter == null) { $this->fd6c72b15565c8e885c3b26238faabaec4f644a06($_GET["filter"]); } $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= ' <h2>' . v_smsanswers_smsanswers . '</h2><p>' . v_smsanswers_description . '</p> <fieldset> <legend><img src="' . self::$setingsImg . '" alt="' . v_smsanswers_smsanswers . '" /> ' . v_smsanswers_smsanswers . '</legend> <form action="" method="post"> <table> <tbody> <tr> <td>' . self::getSelect(array("name" => "year"), self::generateNumbers(2013, date("Y"), false, v_smsanswers_year, 0), $this->year) . '</td> <td>' . self::getSelect(array("name" => "month"), self::generateNumbers(1, 12, false, v_smsanswers_month, -1), $this->month) . '</td> <td>' . self::getInput(array("type" => "submit", "name" => "submitSmsAnswers", "value" => v_smsanswers_show, "class" => "button")) . '</td> </tr> </tbody> </table> </form> </fieldset> '; if(!$this->year) { $this->year = "%"; } $i932312fb17d1da965f0749dc7d67eb943a78e330 = self::premadeDate($this->month); $i3964ab17d4e3c76c12a1b84b29be7bf6f6484dc3 = "WHERE cas LIKE '" . $this->escape($this->year . "-" . $i932312fb17d1da965f0749dc7d67eb943a78e330 . "-%") . "'"; $ic6e936002fe51b97bc1b95f337c09606ceb011de = $this->Execute("SELECT count(*) count FROM " . DB_PREFIX . "sp_answers " . $i3964ab17d4e3c76c12a1b84b29be7bf6f6484dc3 . ""); if($ic6e936002fe51b97bc1b95f337c09606ceb011de->num_rows) { foreach($ic6e936002fe51b97bc1b95f337c09606ceb011de->rows as $i43ef5aef4168652439ef5de195405ced9f0f7952) { $i5d66d7c5090e9cf0a74886f1e059dd6d582d9384 = $i43ef5aef4168652439ef5de195405ced9f0f7952['count']; } } $if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3 = new Paginator($i5d66d7c5090e9cf0a74886f1e059dd6d582d9384, MAX_ROWS, ((isset($_GET["ps"])) ? $_GET["ps"] : 1), $this->smsLinkPageSave($this->filter)); if($i5d66d7c5090e9cf0a74886f1e059dd6d582d9384 > 0) { $iae8c74e5273dec25096dbae362493a9f609ecfc8 .=' <fieldset> <legend><img src="' . self::$catalogImg . '" alt="" /> ' . v_smsanswers_results . ($if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->offset + 1) . " - " . ((($if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->offset + $if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->limit) <= ($if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->num_results)) ? ($if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->offset + $if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->limit) : $if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->num_results) . v_smsanswers_of . $if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->num_results . ' ' . v_smsanswers_sms . '</legend>'; $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= " <table class=\"resultTable\"> <thead> <tr> <th class=\"left\">" . v_smsanswers_number . "</th> <th class=\"w150\">" . v_smsanswers_date . "</th> <th class=\"w200\">" . v_smsanswers_smscenter . "</th> <th class=\"w100\"></th> </tr> </thead> <tbody> "; $i5219ccda793bda0dd2dd47ede46789ad8051decb = "SELECT * FROM " . DB_PREFIX . "sp_answers " . $i3964ab17d4e3c76c12a1b84b29be7bf6f6484dc3 . " ORDER BY ID DESC LIMIT " . $this->escape($if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->offset) . "," . $this->escape($if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->limit) . ""; $ic6e936002fe51b97bc1b95f337c09606ceb011de = $this->Execute($i5219ccda793bda0dd2dd47ede46789ad8051decb); if($ic6e936002fe51b97bc1b95f337c09606ceb011de->num_rows) { foreach($ic6e936002fe51b97bc1b95f337c09606ceb011de->rows as $i43ef5aef4168652439ef5de195405ced9f0f7952) { if(strlen($i43ef5aef4168652439ef5de195405ced9f0f7952['smsc'] > 0)) { $i10ad5d6d094db3ce5e9219d7863b98595a9f202c = "+" . trim($i43ef5aef4168652439ef5de195405ced9f0f7952['smsc']); } else { $i10ad5d6d094db3ce5e9219d7863b98595a9f202c = "-"; } if(!$i43ef5aef4168652439ef5de195405ced9f0f7952['prohlednuto']) { $i35dc3b2d791885ac9605284226e3510fa7a717ac = "<span class=\"blink\">" . v_smsanswers_new . "</span> "; } else { $i35dc3b2d791885ac9605284226e3510fa7a717ac = ""; } if(strlen($i43ef5aef4168652439ef5de195405ced9f0f7952["from"]) > 1) { $i43e73008096636491c57855e1543fbbc5d9c5013 = htmlspecialchars($i43ef5aef4168652439ef5de195405ced9f0f7952["from"]); } else { $i43e73008096636491c57855e1543fbbc5d9c5013 = v_adminsmsprofile_invalidnumber; } $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= " <tr " . self::isEven($if3b517d335a2b4ef26a37d2656c41c234b2a734a, "even") . "> <td> <a id=\"displayText" . $i43ef5aef4168652439ef5de195405ced9f0f7952['ID'] . "\" href=\"javascript:\" onclick=\"toggleInfo(" . $i43ef5aef4168652439ef5de195405ced9f0f7952['ID'] . ");\"> <img src='" . self::$plusImg . "' id=\"toggleButton" . $i43ef5aef4168652439ef5de195405ced9f0f7952['ID'] . "\"/> " . $i43e73008096636491c57855e1543fbbc5d9c5013 . " </a> </td> <td class=\"center\">" . $i43ef5aef4168652439ef5de195405ced9f0f7952['cas'] . "</td> <td class=\"center\">" . $i10ad5d6d094db3ce5e9219d7863b98595a9f202c . "</td> <td class=\"center\">" . $i35dc3b2d791885ac9605284226e3510fa7a717ac . "</td> </tr> <tr id=\"toggleText" . $i43ef5aef4168652439ef5de195405ced9f0f7952['ID'] . "\" class=\"hidden\"> <td colspan=6><b>" . v_smsanswers_text . "</b><br /><pre>" . htmlspecialchars($i43ef5aef4168652439ef5de195405ced9f0f7952['text']) . "</pre></td> </tr> "; } } $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= " <tbody> </table> "; $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= $if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3; $this->Execute("UPDATE " . DB_PREFIX . "sp_answers SET prohlednuto = '1'"); } else { $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= '<div><strong>' . v_smsanswers_nosms . '</strong></div>'; } $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= '</fieldset>'; return $iae8c74e5273dec25096dbae362493a9f609ecfc8; } } 