<?php define("SMS_CONTROLER_URL", DIR_APPLICATION . 'model/sms/'); require_once (defined("SMS_CONTROLER_URL")?SMS_CONTROLER_URL:"") .'smsController.php'; define("MAX_ROWS", 70); class ControllerSmsHistory extends SmsController { public $year; public $month; public $day; public $eshopsms = 1; public $bulksms = 1; public $bulksms2 = 1; public $eshopsms1 = 1; public $status; public $filter; public function index() { $this->defaultValueDefine("year", date("Y")); $this->defaultValueDefine("month", date("m")); parent::index(); } public function ajaxReload($iced8cbcfca3c880f0f157e119d1cc6f8691e7e89) { $this->defaultValueDefine("year", date("Y")); $this->defaultValueDefine("month", date("m")); $this->disableScrollUp(); $ic6e936002fe51b97bc1b95f337c09606ceb011de = $this->Execute("SELECT ID FROM `".DB_PREFIX."sp_sms_history` WHERE `change` = 1 ORDER BY `ID` DESC LIMIT 1"); if($ic6e936002fe51b97bc1b95f337c09606ceb011de->num_rows) { $this->sendSnippet("output", $this->f1dcfb8a6b4edec30b05ee96346c3f5ffb75af176()); } } public function display() { $iae8c74e5273dec25096dbae362493a9f609ecfc8 = parent::display(); $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= "<script type=\"text/javascript\" src=\"" . DIR_SMS_JS . "sms.js\"></script>"; $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= '<div id="snippet-output">'.$this->f1dcfb8a6b4edec30b05ee96346c3f5ffb75af176().'</div>'; if(count($_POST) == 0 && !isset($_GET["filter"]) && !isset($_GET["ps"])) { $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= '<script type="text/javascript"> setInterval( function() { jQuery.getJSON("'.$this->smsLinkHistoryReload().'"); } ,10000); </script>'; } return $iae8c74e5273dec25096dbae362493a9f609ecfc8; } public function postProcess($icddcd508600972f2dab78cd14f7612aa4dc19a18 = NULL, $i6b496fee24729ce6f7683ba88d5a87d6130049b5 = NULL, $ifab26c5df1e4ac29b64e0a4796b1f9165fe614a8 = NULL) { if($icddcd508600972f2dab78cd14f7612aa4dc19a18 == NULL && $i6b496fee24729ce6f7683ba88d5a87d6130049b5 == NULL) { return self::POST_ERROR; } if(isset($ifab26c5df1e4ac29b64e0a4796b1f9165fe614a8['submitSmsHistory'])) { $icddcd508600972f2dab78cd14f7612aa4dc19a18 = $this->escapeInput($icddcd508600972f2dab78cd14f7612aa4dc19a18); unset($icddcd508600972f2dab78cd14f7612aa4dc19a18["submitSmsHistory"]); $this->f87ea1407be58b4a740725f94d5f6240f2d6ee2c0($icddcd508600972f2dab78cd14f7612aa4dc19a18); $this->filter = base64_encode(serialize($icddcd508600972f2dab78cd14f7612aa4dc19a18)); } return self::POST_ERROR; } private static function premadeDate($ie10f888510a016f5ea5f46b736afa9e60fb62395) { if($ie10f888510a016f5ea5f46b736afa9e60fb62395 == -1) { $i37f4b8b95a320aa390065744e77631364347ccc1 = "%"; } elseif(strlen($ie10f888510a016f5ea5f46b736afa9e60fb62395) == 1) { $i37f4b8b95a320aa390065744e77631364347ccc1 = "0" . $ie10f888510a016f5ea5f46b736afa9e60fb62395; } else { $i37f4b8b95a320aa390065744e77631364347ccc1 = $ie10f888510a016f5ea5f46b736afa9e60fb62395; } return $i37f4b8b95a320aa390065744e77631364347ccc1; } private function fd6c72b15565c8e885c3b26238faabaec4f644a06($iced8cbcfca3c880f0f157e119d1cc6f8691e7e89) { $this->filter = $_GET["filter"]; $i47945e993004c137f2a9e8ebe8c6a37da82bbd94 = unserialize(base64_decode($iced8cbcfca3c880f0f157e119d1cc6f8691e7e89)); $this->f87ea1407be58b4a740725f94d5f6240f2d6ee2c0($i47945e993004c137f2a9e8ebe8c6a37da82bbd94); } private function f87ea1407be58b4a740725f94d5f6240f2d6ee2c0($i47945e993004c137f2a9e8ebe8c6a37da82bbd94) { $this->year = $i47945e993004c137f2a9e8ebe8c6a37da82bbd94["year"]; $this->month = $i47945e993004c137f2a9e8ebe8c6a37da82bbd94["month"]; $this->day = $i47945e993004c137f2a9e8ebe8c6a37da82bbd94["day"]; $this->eshopsms = (isset($i47945e993004c137f2a9e8ebe8c6a37da82bbd94["eshopsms"])) ? 1 : 0; $this->bulksms = (isset($i47945e993004c137f2a9e8ebe8c6a37da82bbd94["bulksms"])) ? 1 : 0; $this->bulksms2 = (isset($i47945e993004c137f2a9e8ebe8c6a37da82bbd94["bulksms2"])) ? 1 : 0; $this->eshopsms1 = (isset($i47945e993004c137f2a9e8ebe8c6a37da82bbd94["eshopsms1"])) ? 1 : 0; $this->status = $i47945e993004c137f2a9e8ebe8c6a37da82bbd94["status"]; } private function f1dcfb8a6b4edec30b05ee96346c3f5ffb75af176() { $iae8c74e5273dec25096dbae362493a9f609ecfc8 = ""; $this->Execute("UPDATE `".DB_PREFIX."sp_sms_history` SET `change`= 0;"); if(isset($_GET["filter"]) && $_GET["filter"] != "" && $this->filter == null) { $this->fd6c72b15565c8e885c3b26238faabaec4f644a06($_GET["filter"]); } $i9c6a17481310bf83b3790385a687d69b1e23705c = array(0 => v_smshistory_status, SmsModel::STATUS_SENT => v_smshistory_sent, SmsModel::STATUS_ERROR => v_smshistory_error, SmsModel::STATUS_DELIVERED => v_smshistory_delivered, SmsModel::STATUS_BUFFERED => v_smshistory_buffered, SmsModel::STATUS_SIMULATION => v_smshistory_simulation, SmsModel::STATUS_SHEDULED => v_smshistory_sheduled, SmsModel::STATUS_DELETED => v_smshistory_deleted, SmsModel::STATUS_DND => v_smshistory_dnd, SmsModel::STATUS_DUPLICATE => v_smshistory_duplicate); $i8879dddd1146630085d9a50e23ee706976a01a7a = array(SmsModel::STATUS_SENT => self::$sendImg, SmsModel::STATUS_ERROR => self::$denyImg, SmsModel::STATUS_DELIVERED => self::$acceptImg, SmsModel::STATUS_BUFFERED => self::$bufferedImg, SmsModel::STATUS_SIMULATION => self::$simulationImg, SmsModel::STATUS_SHEDULED => self::$calendarImg, SmsModel::STATUS_DELETED => self::$adminDelete, SmsModel::STATUS_DND => self::$doNotDisturbImg, SmsModel::STATUS_DUPLICATE => self::$duplicateImg); $i8fcc965182a05250706c0db4b99a2ab024b2518b = array(SmsModel::TYPE_ADMIN => v_smshistory_adminsms, SmsModel::TYPE_CUSTOMERS => v_smshistory_customersms, SmsModel::TYPE_MARKETING => v_smshistory_marketingsms, SmsModel::TYPE_SIMPLE => v_smshistory_simplesms); $iac41704afdcfdce40243adf64536a48f8e328240 = array(0 => v_smshistory_no, 1 => v_smshistory_yes); $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= ' <h2>' . v_smshistory_smshistory .'</h2><p>' . v_smshistory_description . '</p> <fieldset> <legend><img src="' . self::$setingsImg . '" alt="' . v_smshistory_smshistory . '" /> ' . v_smshistory_smshistory . '</legend> <form action="" method="post"> <table> <tbody> <tr> <td>' . self::getSelect(array("name" => "year"), self::generateNumbers(2013, date("Y"), false, v_smshistory_year, 0), $this->year) . '</td> <td>' . self::getSelect(array("name" => "month"), self::generateNumbers(1, 12, false, v_smshistory_month, -1), $this->month) . '</td> <td>' . self::getSelect(array("name" => "day"), self::generateNumbers(1, 31, false, v_statistics_day, -1), $this->day) . '</td> <td>' . self::getSelect(array("name" => "status"), $i9c6a17481310bf83b3790385a687d69b1e23705c, $this->status) . '</td> <td>' . self::getInput(array("type" => "checkbox", "name" => "eshopsms1", "value" => 1), $this->eshopsms1) . ' ' . v_smshistory_adminsms . '</td> <td>' . self::getInput(array("type" => "checkbox", "name" => "eshopsms", "value" => 1), $this->eshopsms) . ' ' . v_smshistory_customersms . '</td> <td>' . self::getInput(array("type" => "checkbox", "name" => "bulksms", "value" => 1), $this->bulksms) . ' ' . v_smshistory_marketingsms . '</td> <td>' . self::getInput(array("type" => "checkbox", "name" => "bulksms2", "value" => 1), $this->bulksms2) . ' ' . v_smshistory_simplesms . '</td> <td>' . self::getInput(array("type" => "submit", "name" => "submitSmsHistory", "value" => v_smshistory_show, "class" => "button")) . '</td> </tr> </tbody> </table> </form> </fieldset> '; $if034447d093f2657782924ce222fe850cfabbf2c = $this->escape(self::premadeDate($this->month)); $i029b9ae44a0b7d8427f59fffd17759259fa90446 = $this->escape(self::premadeDate($this->day)); $i7f261894a2f47535041bff3d2f42c3969e819d98 = array(); if($this->eshopsms == 1) { $i7f261894a2f47535041bff3d2f42c3969e819d98[] = 2; } if($this->eshopsms1 == 1) { $i7f261894a2f47535041bff3d2f42c3969e819d98[] = 1; } if($this->bulksms == 1) { $i7f261894a2f47535041bff3d2f42c3969e819d98[] = 3; } if($this->bulksms2 == 1) { $i7f261894a2f47535041bff3d2f42c3969e819d98[] = 4; } if(count($i7f261894a2f47535041bff3d2f42c3969e819d98) > 0) { $idacee85242f68129250771eb362503f41015a410 = " AND " . DB_PREFIX . "sp_sms_history.type IN (" . implode(",", $i7f261894a2f47535041bff3d2f42c3969e819d98) . ")"; } else { $idacee85242f68129250771eb362503f41015a410 = ""; } if($this->status > 0) { $i62b6b7ccb62a11971c871b454301b89c98c3f56c = " AND " . DB_PREFIX . "sp_sms_history.status=" . $this->escape($this->status); } else { $i62b6b7ccb62a11971c871b454301b89c98c3f56c = ""; } if(!$this->year) { $this->year = "%"; } $i9760fdb64f8ceba214ad7a88f934fc02012212fa = $this->year . "-" . $if034447d093f2657782924ce222fe850cfabbf2c . "-" . $i029b9ae44a0b7d8427f59fffd17759259fa90446 . "%"; $i5219ccda793bda0dd2dd47ede46789ad8051decb = "SELECT count(*) AS count FROM " . DB_PREFIX . "sp_sms_history WHERE date LIKE '" . $i9760fdb64f8ceba214ad7a88f934fc02012212fa . "'" . $idacee85242f68129250771eb362503f41015a410 . "" . $i62b6b7ccb62a11971c871b454301b89c98c3f56c . ""; $ic6e936002fe51b97bc1b95f337c09606ceb011de = $this->Execute($i5219ccda793bda0dd2dd47ede46789ad8051decb); if($ic6e936002fe51b97bc1b95f337c09606ceb011de->num_rows) { foreach($ic6e936002fe51b97bc1b95f337c09606ceb011de->rows as $i43ef5aef4168652439ef5de195405ced9f0f7952) { $i5d66d7c5090e9cf0a74886f1e059dd6d582d9384 = $i43ef5aef4168652439ef5de195405ced9f0f7952['count']; } } $if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3 = new Paginator($i5d66d7c5090e9cf0a74886f1e059dd6d582d9384, MAX_ROWS, ((isset($_GET["ps"])) ? $_GET["ps"] : 1), $this->smsLinkPageSave($this->filter)); if($i5d66d7c5090e9cf0a74886f1e059dd6d582d9384 > 0) { $iae8c74e5273dec25096dbae362493a9f609ecfc8 .=' <fieldset> <legend><img src="' . self::$catalogImg . '" /> ' . v_smshistory_results . ($if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->offset + 1) . " - " . ((($if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->offset + $if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->limit) <= ($if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->num_results)) ? ($if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->offset + $if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->limit) : $if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->num_results) . v_smshistory_of . $if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->num_results . ' ' . v_smshistory_sms . '</legend>'; $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= " <table class=\"resultTable\"> <thead> <tr> <th class=\"left\">" . v_smshistory_nubmer . "</th> <th class=\"w150\">" . v_smshistory_recipient . "</th> <th class=\"w200\">" . v_smshistory_subject . "</th> <th class=\"w150\">" . v_smshistory_date . "</th> <th class=\"w150\">" . v_smshistory_type . "</th> <th class=\"w50\">" . v_smshistory_status . "</th> </tr> </thead> <tbody> "; $ic6e936002fe51b97bc1b95f337c09606ceb011de = $this->Execute($this->historySQL($i9760fdb64f8ceba214ad7a88f934fc02012212fa, $idacee85242f68129250771eb362503f41015a410, $i62b6b7ccb62a11971c871b454301b89c98c3f56c, $if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->offset, $if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3->limit)); if($ic6e936002fe51b97bc1b95f337c09606ceb011de->num_rows) { foreach($ic6e936002fe51b97bc1b95f337c09606ceb011de->rows as $i43ef5aef4168652439ef5de195405ced9f0f7952) { if(strlen($i43ef5aef4168652439ef5de195405ced9f0f7952['sender']) > 0 && preg_match("/^([0-9])*$/", $i43ef5aef4168652439ef5de195405ced9f0f7952['sender'], $i978a1b814f9d68d5a56042c5dc05da065d996dd4)) { $i00502941bd7b6c92c64eac6460da167d3a12c272 = htmlspecialchars("+" . $i43ef5aef4168652439ef5de195405ced9f0f7952['sender']); } elseif(strlen($i43ef5aef4168652439ef5de195405ced9f0f7952['sender']) > 0) { $i00502941bd7b6c92c64eac6460da167d3a12c272 = htmlspecialchars($i43ef5aef4168652439ef5de195405ced9f0f7952['sender']); } else { $i00502941bd7b6c92c64eac6460da167d3a12c272 = v_smshistory_sysnumber; } $i939c377efe7edd2b6c1588adceb22c081155b60f = ''; if(($i43ef5aef4168652439ef5de195405ced9f0f7952['status'] == SmsModel::STATUS_ERROR || $i43ef5aef4168652439ef5de195405ced9f0f7952['status'] == SmsModel::STATUS_BUFFERED) && strlen($i43ef5aef4168652439ef5de195405ced9f0f7952['note']) > 0) { $i939c377efe7edd2b6c1588adceb22c081155b60f = " - " . htmlspecialchars($i43ef5aef4168652439ef5de195405ced9f0f7952['note']); } if(strlen($i43ef5aef4168652439ef5de195405ced9f0f7952["number"]) > 1) { $i43e73008096636491c57855e1543fbbc5d9c5013 = htmlspecialchars($i43ef5aef4168652439ef5de195405ced9f0f7952["number"]); } else { $i43e73008096636491c57855e1543fbbc5d9c5013 = v_adminsmsprofile_invalidnumber; } if($i43ef5aef4168652439ef5de195405ced9f0f7952['customer_ID'] != 0 && $i43ef5aef4168652439ef5de195405ced9f0f7952['customer_ID'] != -1) { $i2fb7b08d75ddb5bf1383929c82f63cb5beaca6da = "<a href=\"" .$this->smsLinkCustomer($i43ef5aef4168652439ef5de195405ced9f0f7952["customer_ID"]). "\">" . htmlspecialchars($i43ef5aef4168652439ef5de195405ced9f0f7952["firstname"] . " " . $i43ef5aef4168652439ef5de195405ced9f0f7952["lastname"]) . "</a>"; } elseif($i43ef5aef4168652439ef5de195405ced9f0f7952['admin_ID'] != 0) { $i2fb7b08d75ddb5bf1383929c82f63cb5beaca6da = htmlspecialchars($i43ef5aef4168652439ef5de195405ced9f0f7952["adminName"]); } elseif(strlen($i43ef5aef4168652439ef5de195405ced9f0f7952['recipient']) > 0) { $i2fb7b08d75ddb5bf1383929c82f63cb5beaca6da = htmlspecialchars($i43ef5aef4168652439ef5de195405ced9f0f7952['recipient']); } else { $i2fb7b08d75ddb5bf1383929c82f63cb5beaca6da = "-"; } $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= " <tr " . self::isEven($if3b517d335a2b4ef26a37d2656c41c234b2a734a, "even") . "> <td> <a id=\"displayText" . $i43ef5aef4168652439ef5de195405ced9f0f7952['ID'] . "\" href=\"javascript:\" onclick=\"toggleInfo(" . $i43ef5aef4168652439ef5de195405ced9f0f7952['ID'] . ");\"> <img src='" . self::$plusImg . "' alt=\"" . $i43e73008096636491c57855e1543fbbc5d9c5013 . "\" id=\"toggleButton" . $i43ef5aef4168652439ef5de195405ced9f0f7952['ID'] . "\"/> " . $i43e73008096636491c57855e1543fbbc5d9c5013 . " </a> </td> <td class=\"center\"> " . $i2fb7b08d75ddb5bf1383929c82f63cb5beaca6da . " </td> <td class=\"center\">" . ((strlen($i43ef5aef4168652439ef5de195405ced9f0f7952['subject']) > 0) ? ($i43ef5aef4168652439ef5de195405ced9f0f7952['subject']) : ("-")) . "</td> <td class=\"center\">" . $i43ef5aef4168652439ef5de195405ced9f0f7952['date'] . "</td> <td class=\"center\">" . $i8fcc965182a05250706c0db4b99a2ab024b2518b[$i43ef5aef4168652439ef5de195405ced9f0f7952['type']] . "</td> <td class=\"center\"> <span style=\"cursor:help;\" onclick=\"popup_title(this)\" title=\"" . (($i43ef5aef4168652439ef5de195405ced9f0f7952["status"] == SmsModel::STATUS_SIMULATION)?(v_sendsms_simulation):($i9c6a17481310bf83b3790385a687d69b1e23705c[$i43ef5aef4168652439ef5de195405ced9f0f7952['status']] . $i939c377efe7edd2b6c1588adceb22c081155b60f)) . "\"> <img src='" . $i8879dddd1146630085d9a50e23ee706976a01a7a[$i43ef5aef4168652439ef5de195405ced9f0f7952['status']] . "' alt=\"" . (($i43ef5aef4168652439ef5de195405ced9f0f7952["status"] == SmsModel::STATUS_SIMULATION)?(v_sendsms_simulation):($i9c6a17481310bf83b3790385a687d69b1e23705c[$i43ef5aef4168652439ef5de195405ced9f0f7952['status']] . $i939c377efe7edd2b6c1588adceb22c081155b60f)) . "\" /> </span> </td> </tr> <tr id=\"toggleText" . $i43ef5aef4168652439ef5de195405ced9f0f7952['ID'] . "\" class=\"hidden noHover\"> <td colspan=\"6\"> <table class=\"formTable\"> <tr> <td colspan=\"6\"><strong>" . v_smshistory_smstext . "</strong><br /><pre>" . $i43ef5aef4168652439ef5de195405ced9f0f7952['text'] . "</pre></td> </tr> <tr> <td class=\"w160\"><strong>" . v_smshistory_price . "</strong> " . $i43ef5aef4168652439ef5de195405ced9f0f7952['price'] . "</td> <td class=\"w160\"><strong>" . v_smshistory_balance . "</strong> " . (($i43ef5aef4168652439ef5de195405ced9f0f7952['price'] > 0) ? $i43ef5aef4168652439ef5de195405ced9f0f7952["credit"] : " - ") . "</td> <td class=\"w100\"><strong>" . v_smshistory_totalsms . "</strong> " . $i43ef5aef4168652439ef5de195405ced9f0f7952['total'] . "</td> <td class=\"w100\"><strong>" . v_smshistory_unicode . "</strong> " . $iac41704afdcfdce40243adf64536a48f8e328240[$i43ef5aef4168652439ef5de195405ced9f0f7952['unicode']] . "</td> <td class=\"w220\"><strong>" . v_smshistory_senderid . "</strong> " . $i00502941bd7b6c92c64eac6460da167d3a12c272 . "</td> <td><strong>SMS ID:</strong> " . ((strlen($i43ef5aef4168652439ef5de195405ced9f0f7952['smsID'])) ? $i43ef5aef4168652439ef5de195405ced9f0f7952['smsID'] : " - ") . "</td> </tr> </table> </td> </tr> "; } } $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= " </tbody> </table> "; $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= $if0a2bae9382b0eaeb0e815bf9ea63fdbd6af6bc3; } else { $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= ' <div> <b>' . v_smshistory_nosms . '</b> </div>'; } $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= " <script language=\"javascript\"> var minus = '" . self::$minusImg . "'; var plus = '" . self::$plusImg . "'; </script> "; $iae8c74e5273dec25096dbae362493a9f609ecfc8 .= '</fieldset>'; return $iae8c74e5273dec25096dbae362493a9f609ecfc8; } } 