var cc_for_ie=0;document.write(unescape("%3Clink rel='stylesheet' href='http://automag-sp.ru/callcons/css/style.css' type='text/css'%3E"));document.write(unescape("%3Clink rel='stylesheet' href='http://automag-sp.ru/callcons/css/settings.css' type='text/css'%3E"));document.write(unescape("%3Cscript src='http://automag-sp.ru/callcons/js/settings.js' charset='utf-8' type='text/javascript'%3E%3C/script%3E"));if(typeof jQuery!='function'){var script_tag=document.createElement('script');script_tag.setAttribute("type","text/javascript");script_tag.setAttribute("src","http://automag-sp.ru/callcons/js/jquery.js");script_tag.onload=loadCookie;script_tag.onreadystatechange=function(){if(this.readyState=='complete'||this.readyState=='loaded'){loadCookie()}};(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(script_tag)}else{loadCookie()}function loadCookie(){if(typeof(jQuery.cookie)!='function'){var script_tag=document.createElement('script');script_tag.setAttribute("type","text/javascript");script_tag.setAttribute("src","http://automag-sp.ru/callcons/js/cookie.js");script_tag.onload=call_main;script_tag.onreadystatechange=function(){if(this.readyState=='complete'||this.readyState=='loaded'){call_main()}};(document.getElementsByTagName("head")[0]||document.documentElement).appendChild(script_tag)}else{call_main()}}function call_main(){if(cc_for_ie==0){cc_for_ie=1;jQuery(document).ready(function(){set_call_info();if(st_button){jQuery('body').append('<div id="callcons_b" class="callcons_b"></div>');if(cc_position=="ok_left_center"||cc_position=="ok_right_center"){jQuery('#callcons_b').html('<div id="call_b_text"></div>');var _call_b_text="";for(var i=0;i<call_b_text.length;i++){_call_b_text+='<div class="call_b_char">'+call_b_text[i]+'</div>'}jQuery('#call_b_text').html(_call_b_text)}else{jQuery('#callcons_b').text(call_b_text)}}jQuery('body').append('<div id="callcons_f"></div>');jQuery('body').append('<div id="callcons_black"></div>');jQuery('#callcons_f').load('../callcons/callform.php',function(){if(!view_name)jQuery('#call_name_div').css('display','none');if(!view_email)jQuery('#call_email_div').css('display','none');if(!view_comment)jQuery('#call_text_div').css('display','none');if(!view_time)jQuery('#call_time_div').css('display','none');call_settings();jQuery('#call_order').hover(function(){jQuery('#call_order').css({'color':cc_chat_color,'background-color':'#FFF'})},function(){jQuery('#call_order').css({'color':'#FFF','background-color':cc_chat_color})});if(window_center){jQuery('.callcons_b').click(function(){jQuery('#callcons_f').css({'left':'50%','top':'170px','margin-left':'-155px'});show_window()})}else{jQuery('.callcons_b').click(function(e){var x=e.pageX+30;var y=e.pageY+30;var b_width=jQuery('body').width();var b_height=jQuery(window).height();if(b_width<(x+330)){x=x-370}var callcons_f_h=~~jQuery('#callcons_f').height();if(b_height<(y+callcons_f_h)){y=b_height-callcons_f_h-30}jQuery('#callcons_f').css({'left':x,'top':y});show_window()})}jQuery('#call_close').click(close_window);jQuery('#callcons_black').click(close_window);jQuery('#call_order').click(call_order);if(jQuery.cookie('call_name')!==null)jQuery('#call_name').val(jQuery.cookie('call_name'));if(jQuery.cookie('call_tell')!==null)jQuery('#call_tell').val(jQuery.cookie('call_tell'));if(jQuery.cookie('call_email')!==null)jQuery('#call_email').val(jQuery.cookie('call_email'))})})}}function call_order(){jQuery('.not_filled').removeClass('not_filled');jQuery('#callcons_mess').css('display','none');jQuery('#callcons_send').css('display','block');var json_form_data='{';if(jQuery.trim(jQuery('#call_tell').val())==""){callcons_mess('Введите номер телефона','call_tell');return}else{jQuery.cookie('call_tell',jQuery('#call_tell').val());json_form_data+='"call_tell":"'+jQuery('#call_tell').val()+'"'}if(mand_name&&jQuery.trim(jQuery('#call_name').val())==""){callcons_mess('Введите Ваше имя','call_name');return}else{jQuery.cookie('call_name',jQuery('#call_name').val());json_form_data+=',"call_name":"'+jQuery('#call_name').val()+'"'}if(mand_email&&jQuery.trim(jQuery('#call_email').val())==""){callcons_mess('Введите Ваш email','call_email');return}else{if(jQuery.trim(jQuery('#call_email').val())!=""){if(!validEmail(jQuery('#call_email').val())){callcons_mess('Введите правильный email','call_email');return}else{jQuery.cookie('call_email',jQuery('#call_email').val());json_form_data+=',"call_email":"'+jQuery('#call_email').val()+'"'}}}if(mand_time&&jQuery.trim(jQuery('#call_time').val())==""){callcons_mess('Введите время звонка','call_time');return}else json_form_data+=',"call_time":"'+jQuery('#call_time').val()+'"';if(mand_comment&&jQuery.trim(jQuery('#call_text').val())==""){callcons_mess('Введите комментарий','call_text');return}else json_form_data+=',"call_text":"'+jQuery('#call_text').val()+'"';json_form_data+='}';var json_moving_data=jQuery.cookie('call_moving');var json_info_data='{"call_visit":"'+jQuery.cookie('call_visit')+'", "call_last_visit":"'+jQuery.cookie('call_last_visit')+'", "call_referrer":"'+jQuery.cookie('call_referrer')+'"}';jQuery('#callcons_send').css('display','block');jQuery.ajax({url:'../callcons/class/processing_form.php',type:'POST',data:{json_form_data:json_form_data,json_moving_data:json_moving_data,json_info_data:json_info_data},cache:false,error:function(){alert('Error!')},success:function(result){if(result==true){jQuery('#callcons_mess').html('Сообщение отправлено')}else{jQuery('#callcons_mess').html('Ошибка, попробуйте еще')}jQuery('#callcons_send').css('display','none');jQuery('#callcons_mess').css('display','block')}})}function set_call_info(){var call_date=new Date();var call_last_visit=Math.floor(call_date.getTime()/1000);var call_referrer;if(jQuery.trim(document.referrer)==""){call_referrer="Напрямую"}else{call_referrer=document.referrer}jQuery.cookie('call_last_visit',call_last_visit,1000);if(remove_data()){jQuery.cookie('call_referrer',call_referrer,10);if(jQuery.cookie('call_visit')==null){jQuery.cookie('call_visit',1)}else{var call_visit=jQuery.cookie('call_visit');call_visit++;jQuery.cookie('call_visit',call_visit)}}var call_moving=new Array();if(!jQuery.cookie('call_moving')){var call_json='[{"call_href": "'+document.location.href+'", "call_title":"'+document.getElementsByTagName("title")[0].text+'", "call_time":"'+call_last_visit+'"}]';jQuery.cookie('call_moving',call_json)}else{var moving=JSON.parse(jQuery.cookie('call_moving'));call_json='{"call_href": "'+document.location.href+'", "call_title":"'+document.getElementsByTagName("title")[0].text+'", "call_time":"'+call_last_visit+'"}';call_json=JSON.parse(call_json);moving.push(call_json);jQuery.cookie('call_moving',JSON.stringify(moving))}}function remove_data(){if(jQuery.cookie('call_session')==null){jQuery.cookie('call_referrer',null);jQuery.cookie('call_moving',null);jQuery.cookie('call_session','true');return true}else{return false}}function show_window(){jQuery('#callcons_f').fadeIn(250);if(window_black){jQuery('#callcons_black').css('display','block')}}function close_window(){jQuery('#callcons_f').fadeOut(150);jQuery('#callcons_black').css('display','none')}function call_settings(){jQuery('.call_h span').text(call_text);jQuery('.call_h').css('background-color',cc_chat_color);jQuery('#callcons_f').css('border-color',cc_chat_color);jQuery('#call_order').css({'background-color':cc_chat_color,'border-color':cc_chat_color});if(view_asterisk){jQuery('#call_tell_div .call_form_name').append('<span style="color: red;">*</span>');if(mand_name)jQuery('#call_name_div .call_form_name').append('<span style="color: red;">*</span>');if(mand_email)jQuery('#call_email_div .call_form_name').append('<span style="color: red;">*</span>');if(mand_time)jQuery('#call_time_div .call_form_name').append('<span style="color: red;">*</span>');if(mand_comment)jQuery('#call_text_div .call_form_name').append('<span style="color: red;">*</span>')}}function callcons_mess(mess,e_class){jQuery('#'+e_class).addClass('not_filled');jQuery('#'+e_class).focus();jQuery('#callcons_mess').text(mess);jQuery('#callcons_mess').css('display','block');jQuery('#callcons_send').css('display','none')}function validEmail(email){var re=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;if(re.test(email)){return true}else{return false}}function array2json(arr){var parts=[];var is_list=(Object.prototype.toString.apply(arr)==='[object Array]');for(var key in arr){var value=arr[key];if(typeof value=="object"){if(is_list)parts.push(array2json(value));else parts[key]=array2json(value)}else{var str="";if(!is_list)str='"'+key+'":';if(typeof value=="number")str+=value;else if(value===false)str+='false';else if(value===true)str+='true';else str+='"'+value+'"';parts.push(str)}}var json=parts.join(",");if(is_list)return'['+json+']';return'{'+json+'}'}