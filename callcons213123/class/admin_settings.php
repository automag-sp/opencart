<?php
 error_reporting(0); session_start(); class AdminSettings { public $admin_file = '../config/admin_config.php'; public $settings_js = '../js/settings.js'; public $settings_css = '../css/settings.css'; public function __construct() { if (!$this->saveAdmin() OR !$this->saveChatSettings()) { $this->message('Ошибка!!! Не удалось сохранить настройки'); } else { $this->message('Настройки успешно сохранены'); } } public function saveChatSettings() { $settings_js = ""; if (isset($_POST['view_name'])) { $settings_js .= "var view_name = true;"; } else { $settings_js .= "var view_name = false;"; } if (isset($_POST['view_email'])) { $settings_js .= "var view_email = true;"; } else { $settings_js .= "var view_email = false;"; } if (isset($_POST['view_comment'])) { $settings_js .= "var view_comment = true;"; } else { $settings_js .= "var view_comment = false;"; } if (isset($_POST['view_time'])) { $settings_js .= "var view_time = true;"; } else { $settings_js .= "var view_time = false;"; } if (isset($_POST['mand_name'])) { $settings_js .= "var mand_name = true;"; } else { $settings_js .= "var mand_name = false;"; } if (isset($_POST['mand_email'])) { $settings_js .= "var mand_email = true;"; } else { $settings_js .= "var mand_email = false;"; } if (isset($_POST['mand_comment'])) { $settings_js .= "var mand_comment = true;"; } else { $settings_js .= "var mand_comment = false;"; } if (isset($_POST['mand_time'])) { $settings_js .= "var mand_time = true;"; } else { $settings_js .= "var mand_time = false;"; } if (isset($_POST['window_center'])) { $settings_js .= "var window_center = true;"; } else { $settings_js .= "var window_center = false;"; } if (isset($_POST['st_button'])) { $settings_js .= "var st_button = true;"; } else { $settings_js .= "var st_button = false;"; } if (isset($_POST['window_black'])) { $settings_js .= "var window_black = true;"; } else { $settings_js .= "var window_black = false;"; } if (isset($_POST['view_asterisk'])) { $settings_js .= "var view_asterisk = true;"; } else { $settings_js .= "var view_asterisk = false;"; } $settings_js .= "var cc_chat_color = '{$_POST['chat_color']}' ;"; $settings_js .= "var ok_button_color = '{$_POST['button_color']}' ;"; $settings_js .= "var call_text = '{$_POST['call_text']}' ;"; $settings_js .= "var call_b_text = '{$_POST['call_b_text']}' ;"; $settings_js .= "var cc_position = '{$_POST['chat_position']}' ;"; $settings_css = ""; switch ($_POST['chat_position']) { case "ok_left_center": $settings_css .= "#callcons_b{left: 0px;top: 25%; width: 25px; height: auto; background: {$_POST['button_color']}; padding: 12px 1px;} .call_b_char{line-height: 9px;}"; break; case "ok_right_center": $settings_css .= "#callcons_b{right: 0px;top: 25%; width: 25px; height: auto; background: {$_POST['button_color']}; padding: 12px 1px;} .call_b_char{line-height: 7px;}"; break; case "ok_top_center": $settings_css .= "#callcons_b{left: 50%;top: 0; margin-left: -80px;  height: 25px; background: {$_POST['button_color']}; padding: 0 10px; }"; break; case "ok_bottom_center": $settings_css .= "#callcons_b{left: 50%;bottom: 0; margin-left: -80px;  height: 25px; background: {$_POST['button_color']} ; padding: 0 10px;}"; break; case "ok_bottom_right": $settings_css .= "#callcons_b{right: 0;bottom: 0;  height: 25px; background: {$_POST['button_color']} ; padding: 0 10px;}"; break; case "ok_bottom_left": $settings_css .= "#callcons_b{left: 0;bottom: 0;  height: 25px; background: {$_POST['button_color']} ; padding: 0 10px;}"; break; case "ok_top_left": $settings_css .= "#callcons_b{left: 0;top: 0;  height: 25px; background: {$_POST['button_color']} ; padding: 0 10px;}"; break; case "ok_top_right": $settings_css .= "#callcons_b{right: 0;top: 0;  height: 25px; background: {$_POST['button_color']} ; padding: 0 10px;}"; break; } if (!file_put_contents($this->settings_js, $settings_js)) { return false; } else { if (!file_put_contents($this->settings_css, $settings_css)) { return false; } else { return true; } } } public function saveAdmin() { $data = '<?php define("ADMIN_LOGIN", "'.$_POST["admin_login"].'"); define("ADMIN_PASSWORD", "'.$_POST['admin_password'].'"); define("OFFLINE_EMAIL", "'.$_POST['admin_email'].'");'; if (!file_put_contents($this->admin_file, $data)) { return false; } else { return true; } } public function message($message) { $_SESSION['messages'] = $message; header('Location: http://automag-sp.ru/callcons/index.php'); exit; } } if (isset($_SESSION['who']) AND $_SESSION['who'] == "admin") { $obj = new AdminSettings(); } else { header('Location: http://automag-sp.ru/callcons/index.php'); exit; } ?>
